{% extends "base.html" %}
{% load static %}
{% block title %} {{ product.name }} {% endblock %}
{% block content %}
    <div class="product__page">
        <div class="container">
            <div class="product_page__content flex--row">
                <div class="product_page__images flex--column">
                    <img class="product_page_images__bigimg" src="{% if product.preview %}{{ product.preview.url }}{% else %}{% static 'images/placeholderImage.png' %}{% endif %}">
                    <div class="product_page_images__block flex--row">
                        {% for image in images %}
                            <img class="product_page_images_block__image" src="{{ image.image.url }}">
                        {% endfor %}
                    </div>
                </div>
                <div class="product_page__info flex--column">
                    <p class="product_page_info__seller text--default">{{ product.seller.username }}<img src="{% if is_verified %}{% static 'svg/verified.svg' %}{% endif %}" alt=""></p>
                    <p class="product_page_info__title">{{ product.name }}</p>
                    <div class="product_page_info__main flex--column">
                        <div class="product_page_info_main__rating flex--row">
                            <p class="product_page_info_main_rating__mark">{{ product_rating }}</p>
                            <img class="product_page_info_main_rating__pic" src="{% static 'svg/star.svg' %}">
                            <p class="product_page_info_main_rating__count">
                                <a href="{% url 'forum:product_discussion' product.id %}" class="product_page_info_main_rating_count__link">{{ marks_count }} оценок</a>
                            </p>
                        </div>
                        <div class="product_page__info_main__images flex--row">
                            <img class="product_page_images_block__image" src="../../static_dev/images/gutsTest.jpg">
                            <img class="product_page_images_block__image" src="../../static_dev/images/gutsTest.jpg">
                            <img class="product_page_images_block__image" src="../../static_dev/images/gutsTest.jpg">
                        </div>
                        <div class="product_page_main_info__stats flex--column">
                            <p class="product_page_main_info_stats__title text--default">Характеристики</p>
                            <p class="product_page_main_info_stats__text text text--default">smth</p>
                            <p class="product_page_main_info_stats__title text--default">Описание</p>
                            <p class="product_page_main_info_stats__text text text--default">{{ product.description|linebreaks }}</p>
                        </div>
                    </div>
                </div>
                <div class="product_page__buying flex--column">
                    <input hidden name="id" value="{{ product.id }}">
                    <p class="product_page_buying__price text--default">{{ product.price }} &#8381;</p>
                    <form action="." method="POST">
                        {% csrf_token %}
                        <button class="product_page_button button button--lgreen text--default" type="button" 
                        onclick="addCart(this)">
                            В корзину
                        </button>
                    </form>
                    <form action="{% url 'users:cart' %}" method="POST">
                        {% csrf_token %}
                        <button class="product_page_button button button--lgreen text--default" type="button" 
                        onclick="addCart(this)">
                            Купить
                        </button>
                    </form>
                    <button onclick="window.location.href = '{% url "forum:product_discussion" product.id %}';" class="product_page_button button button--lgreen text--default">
                        Форум
                    </button>
                </div>
                <script>
                    function addCart(clickedElement){
                        var frm = $(clickedElement).parent();
                        var button = $(clickedElement);
                        var data = $(frm).serialize();
                        $.ajax({
                            type: 'POST',
                            data: data,
                            url: '',
                            success:  function (data) {
                                console.log("OK Adding");
                            },
                            error: function () {
                                console.log('I want to die');
                            }
                        });
                        return false;
                    }
                </script>
            </div>
        </div>
    </div>
{% endblock %}
